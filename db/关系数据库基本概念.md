# 关系数据库基本概念

## 数据库基本概念

### 数据视图

由于设计数据库时，为了屏蔽数据库的底层实现的复杂性。我们将数据库的实现分为几个层次：

* 物理层次，物理层次是最底层的层次，描述了数据库中的数据时怎么存储的，物理层次详细描述了数据库中数据存储的数据结构。

* 逻辑层次，逻辑层次是比物理层次具有稍高的抽象，在该层次中描述了数据库存储了哪些数据，以及这些数据之间的关系。通过少量相对简单的结构来描述整个数据库。

* 视图层次，视图层次是最高层次的抽象，只描述整个数据库的某个部分。由于数据库存储信息的多样性，在逻辑层次仍会存在一定程度的复杂性。而在视图层次，只会关注数据的一部分。

### 实例和模式

在数据库中，随着时间的推移，数据库中的数据会不断被更改，数据库也就发生了变化。在特定时刻存储在数据库中的信息集合称为数据库的一个实例。我们把数据库的总体设计称为数据库的模式。

对应上面介绍的三种数据视图，对应了三种数据库模式来描述不同层次的数据视图：

* 物理模式
* 逻辑模式
* 子模式

### 数据模型

数据库的基础是数据模型。数据模型是一个描述数据、数据联系、数据语义以及一致性约束的概念工具的集合。

我们目前主流的数据库的数据模型是关系模型：

关系模型使用表的集合来表示数据和数据之间的联系。每个表有多个列，每个列有唯一的列名。关系模型是基于记录的模型的一种。

### 数据库语言

数据库系统提供了数据定义语言（DDL）来定义数据库模式，通过数据操作语言（DML）来定义数据库的查询和更新。在实际使用中，这两种语言被包含在一起，构成了一个单一的数据库语言，SQL语言就是其中使用最广泛的。

数据操作语言（Data-Manipulation Language，DML）使用户可以访问和操作那些按照某种适当的数据模型组织起来的数据，具有以下的访问类型：

* 对存储在数据库中的信息进行检索
* 向数据库中插入新的信息
* 从数据库删除信息
* 修改数据库中存储的信息

上面的4中操作类型，对应了数据库中“增(Create)删(Delete)改(Update)查(Retrieve)”的四中行为。

通常有两种基本的数据操作语言：

* 过程化DML 要求用户指定需要什么数据以及如何获得这些数据。
* 声明式DML 也成为非过程化DML，只要求用户指定需要什么数据，而不需要指定怎么获得这些数据。o

数据定义语言（Data-Definition Language，DDL）通过一系列的定义来描述数据库模式。

存储在数据库中的数据，必须满足一些一致性约束：

* 域约束。每个属性都必须对应于一个所有可能的取值构成的域（如整型、字符串、日期等）。声明一个属性的类型就相当于约束了它可以取值的值。域约束是完整性约束中最基本的形式。
* 参照完整性约束。在一个关系上的给定属性的集合也在另一个关系的某个属性集的取值中出现
* 断言。一个断言，就是数据库需要时刻满足的某一个条件。域约束和参照完整性约束是断言的特殊形式。
* 授权。为了对不同的用户加以区别，对于不同的用户，在数据库中的不同的数据值上允许不同的访问类型。这些区别通过授权来表达。
最常见的权限包括：读权限，插入权限，更新权限，删除权限。

DDL以一些命令作为输入，DDL的输出存放在数据字典中。数据字典包含了数据库的元数据。在数据库读取和修改实际数据前，数据库系统会首先参考数据字典。

### 数据的存储和查询

数据库系统依据不同的功能，将整个系统划分为不同的模块。数据库系统功能部件大致可以被划分为存储管理器和查询处理器两个模块。

#### 存储管理器

存储管理器是数据库系统中负责在数据库中存储的底层数据和应用程序以及向操作系统提交的查询之间提供接口的部件。存储管理器负责和文件管理器进行交互。原始数据通过操作系统提供的文件系统存储在存储介质上。存储管理器将各种DML命令翻译成底层的文件系统命令，所以文件存储管理器负责数据库中数据的存储、检索和更新。

存储管理部件包括：

* 权限以及完整性管理器，它检测是否满足完整性约束，并检查视图访问数据的用户的权限。
* 事务管理器，它保证即使发生了故障，数据库也保持在一致性的状态，并且保证事务的处理不会发生冲突。
* 文件管理器，它管理磁盘存储空间的分配，管理用于表示磁盘上存储的数据的数据结构。
* 缓冲区管理器，它负责将数据从存储介质中读取到内存中，并决定哪些数据需要存储在内存的缓冲区中。缓冲区管理器是数据库中的一个关键部分，因为它使数据库可以处理比内存大很多的数据。

存储管理器实现了一种数据结构，作为数据库物理实现的一部分：

* 数据文件，存储数据库自身。
* 数据字典，存储关于数据库结构的元数据，包括数据库的模式。
* 索引，提供对数据项的快速访问。

#### 查询处理器

查询处理器模块包括：

* DDL解释器，它解释DDL语句，并将这些数据定义记录到数据字典中。
* DML编译器，它将查询语言中的DML语句翻译为一个执行方案，包括一系列查询执行引擎可以理解的低级指令。
* 查询执行引擎，它执行由DML编译器产生的低级指令。

### 事务管理

事务是数据库应用中完成单一逻辑功能的操作集合。每一个事务是一个既具有原子性又具有一致性的单元。我们要求事务不能违反任何的数据库的一致性约束，也就是说，在执行事务前后，数据库必须是一致的。

事务管理器包括并发控制管理器和恢复管理器：

* 并发控制管理器，它保证当多个事务同时执行的情况下，保证数据库的一致性。
* 恢复管理器，它保证数据库事务的原子性和持久性。

## 关系数据库

关系数据库是由表的集合构成的，每个表具有唯一的名字。

一般来说，关系数据库中的一行代表了一组值之间的一种联系，由于一个表是这种联系的一个集合。表这个概念和数学上的关系的概念是密切相关的。在数学术语中，元组只是一组值的序列，在n个值之间的一种联系可以在数学上用关于这些值的一个元组来表示。这样，在关系数据库中，一个关系可以用一个表来表示，而一个元组可以用表中的行来表示。而属性表示一个表中的列。

### 码

我们必须有一种区分给定关系中的不同元组的方法。这可以通过元组中的属性来进行区分。也就是说，一个元组的属性值可以唯一的区分一个元组，即任何两个元组不可能在所有属性上的取值都相同。

超码，是一个或多个属性的集合，这些属性的组合可以使我们在一个关系中唯一的标识一个元组。在超码中，可能会包含一些无关紧要的属性，如果一个属性集是一个超码，那么这个属性集的超集也必然是一个超码。如果一个属性集的任何真子集都不能成为超码，那么这样的最小超码被称为候选码。

在数据库设计中，我们在所有的候选码中选择其中一个候选码，用于区分关系中不同的元组，这个别选中的候选码在术语上被称为主码。

### 参照关系和被参照关系

一个关系模式（r1）可能在它的属性中包括了另一个关系模式（r2）的主码。那么，这个属性在r1上被称为参照r2的外码。关系r1也别称为外码依赖的参照关系，关系r2被称为外码的被参照关系。

在参照关系中任何元组在特定属性上的取值必须等于别参照关系中某个元组在特定属性上的取值，这个约束条件被称为参照完整性约束。
